<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeafLoaf - 11Labs Conversational AI</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f4f8;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        h1 {
            color: #2d3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .info-box {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #4caf50;
        }
        .info-box h3 {
            margin-top: 0;
            color: #2e7d32;
        }
        .steps {
            background: #f5f5f5;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .steps li {
            margin: 10px 0;
            line-height: 1.6;
        }
        .code-block {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
        }
        .note {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
            margin: 20px 0;
        }
        .webhook-status {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        .status-item:last-child {
            border-bottom: none;
        }
        .status-ok {
            color: #4caf50;
            font-weight: bold;
        }
        .status-error {
            color: #f44336;
            font-weight: bold;
        }
        button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 0;
        }
        button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçÉ LeafLoaf - 11Labs Conversational AI Setup</h1>
        
        <div class="info-box">
            <h3>About 11Labs Conversational AI</h3>
            <p>11Labs provides a complete conversational AI platform with:</p>
            <ul>
                <li><strong>Natural conversation flow</strong> - Built-in turn-taking model</li>
                <li><strong>Low latency</strong> - ~75ms response time</li>
                <li><strong>Speech recognition</strong> - Automatic transcription</li>
                <li><strong>Tool integration</strong> - Calls your webhooks for actions</li>
                <li><strong>Interruption handling</strong> - Natural conversation dynamics</li>
            </ul>
        </div>

        <div class="steps">
            <h3>Setup Steps:</h3>
            <ol>
                <li>
                    <strong>Create an 11Labs Conversational Agent:</strong>
                    <br>Go to <a href="https://elevenlabs.io/app/conversational-ai" target="_blank">11Labs Conversational AI Dashboard</a>
                </li>
                <li>
                    <strong>Configure your agent with this prompt:</strong>
                    <div class="code-block">You are a helpful shopping assistant for Leaf and Loaf, an organic grocery store. 
Help customers find products, add items to their cart, and complete orders.

When customers ask for products, search for them using the search_products tool.
When they want to add items, use the add_to_cart tool.
Always confirm what you're adding before doing so.
Be friendly and guide customers through their shopping experience.</div>
                </li>
                <li>
                    <strong>Add these webhook tools in the agent settings:</strong>
                    <ul>
                        <li>Search Products: <code>http://localhost:8080/api/v1/voice/webhook/search</code></li>
                        <li>Add to Cart: <code>http://localhost:8080/api/v1/voice/webhook/add_to_cart</code></li>
                        <li>Show Cart: <code>http://localhost:8080/api/v1/voice/webhook/show_cart</code></li>
                        <li>Confirm Order: <code>http://localhost:8080/api/v1/voice/webhook/confirm_order</code></li>
                    </ul>
                </li>
                <li>
                    <strong>Get your Agent ID and add to .env:</strong>
                    <div class="code-block">ELEVENLABS_AGENT_ID=your_agent_id_here</div>
                </li>
                <li>
                    <strong>Use their SDK or embed widget:</strong>
                    <br>11Labs provides embeddable widgets and SDKs for web integration
                </li>
            </ol>
        </div>

        <div class="note">
            <strong>Note:</strong> For production, you'll need to:
            <ul>
                <li>Use ngrok or deploy your webhooks to a public URL</li>
                <li>Update the webhook URLs in your 11Labs agent configuration</li>
                <li>Set up proper authentication for webhook security</li>
            </ul>
        </div>

        <div class="webhook-status">
            <h3>Webhook Endpoints Status:</h3>
            <div id="webhook-status-list">
                <div class="status-item">
                    <span>Search Products</span>
                    <span id="search-status">Checking...</span>
                </div>
                <div class="status-item">
                    <span>Add to Cart</span>
                    <span id="cart-status">Checking...</span>
                </div>
                <div class="status-item">
                    <span>Show Cart</span>
                    <span id="show-status">Checking...</span>
                </div>
                <div class="status-item">
                    <span>Confirm Order</span>
                    <span id="confirm-status">Checking...</span>
                </div>
            </div>
            <button onclick="checkWebhooks()">Check Webhook Status</button>
        </div>

        <div class="info-box" style="margin-top: 30px; background: #e3f2fd; border-color: #2196f3;">
            <h3 style="color: #1565c0;">Testing with 11Labs Widget</h3>
            <p>Once you've created your agent, you can embed it here:</p>
            <div class="code-block">
&lt;script src="https://elevenlabs.io/convai-widget/index.js"&gt;&lt;/script&gt;
&lt;elevenlabs-convai agent-id="YOUR_AGENT_ID"&gt;&lt;/elevenlabs-convai&gt;
            </div>
            <p>Or use their phone number integration for testing!</p>
        </div>
    </div>

    <script>
        async function checkWebhooks() {
            const endpoints = [
                { path: '/search', id: 'search-status' },
                { path: '/add_to_cart', id: 'cart-status' },
                { path: '/show_cart', id: 'show-status' },
                { path: '/confirm_order', id: 'confirm-status' }
            ];

            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(`http://localhost:8080/api/v1/voice/webhook${endpoint.path}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(endpoint.path === '/search' ? { query: 'test' } : { session_id: 'test' })
                    });
                    
                    const statusEl = document.getElementById(endpoint.id);
                    if (response.ok) {
                        statusEl.textContent = '‚úì Active';
                        statusEl.className = 'status-ok';
                    } else {
                        statusEl.textContent = '‚úó Error';
                        statusEl.className = 'status-error';
                    }
                } catch (error) {
                    const statusEl = document.getElementById(endpoint.id);
                    statusEl.textContent = '‚úó Offline';
                    statusEl.className = 'status-error';
                }
            }
        }

        // Check on load
        window.onload = checkWebhooks;
    </script>
</body>
</html>